"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parsePackageDiff = void 0;
const gitPatchParser = require("git-patch-parser");
function getDiffVersion(content, packageName) {
    const regex = /(?<=")(.*?)(?=")/g;
    return content
        .replace(packageName, "")
        .replace(":", "")
        .trim()
        .match(regex)
        .pop();
}
function parsePackageDiff(packageName, patch) {
    const diffs = gitPatchParser.parseUnifiedDiff(patch)
        .reduce((memo, it) => memo.concat(it.lines), []);
    const before = diffs.find((diff) => {
        return diff.type === "removed" && diff.content.trim().includes(packageName);
    });
    const after = diffs.find((diff) => {
        return diff.type === "added" && diff.content.trim().includes(packageName);
    });
    return [
        before ? getDiffVersion(before.content, packageName) : null,
        after ? getDiffVersion(after.content, packageName) : null
    ];
}
exports.parsePackageDiff = parsePackageDiff;
//# sourceMappingURL=parsePackageDiff.js.map